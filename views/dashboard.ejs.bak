<% title = "Habit Tracker - Dashboard" %>
<h1 class="text-center my-3">Your Habits</h2>

<form action="/habits/new/<%= user._id%>" method="post">
	<div class="input-group mb-3 mx-auto" style="width: 60rem;">
		<input type="text" class="form-control" name="desc" placeholder="Add a new habit..." aria-label="Add a new habit..." aria-describedby="button-addon2" required>
		<button class="btn btn-outline-secondary" type="submit" id="button-addon2">Add Habit</button>
	</div>
</form>

<div class="btn-group d-flex justify-content-center align-items-center">
	<div class="btn-group">
		<button id="daily-view-btn" class="btn btn-primary <%= view === 'daily' ? 'active' : '' %>">Daily</button>
	</div>
	<div class="btn-group">
		<button id="weekly-view-btn" class="btn btn-primary <%= view === 'weekly' ? 'active' : '' %>">Weekly</button>
	</div>
</div>

<% if (user.habits) { %>

	<ul class="list-group my-2 col col-10 mx-auto">
		<% for (let i = user.habits.length - 1; i >= 0; i--) { %>
			<li class="list-group-item d-flex justify-content-between align-items-center gap-1 border-bottom p-2">

				<div class="align-self-center" style="width: 8rem; font-weight: bold;">
					<%= user.habits[i].desc %>
				</div>

				<% if (view === 'weekly') { %>
					<% for (let j = 0; j < user.habits[i].dates.length; j++) { %>
						<div id="weekly-view" class="d-flex flex-column justify-content-center align-items-center gap-1">
							<%= j !== user.habits[i].dates.length - 1 ? user.habits[i].dates[j].Date.toLocaleDateString('en-IN') : 'Today' %>
							<br>
							<form action="/habits/status/?habitId=<%= user.habits[i]._id %>&dateId=<%= user.habits[i].dates[j]._id %>" method="post">
								<button type="submit" style="border: none; background: transparent;">
									<% if (user.habits[i].dates[j].Status === 'None') { %>
										<i class="fa-solid fa-circle" style="font-size: 32px; color: white;"></i>
									<% } else if(user.habits[i].dates[j].Status === 'Not Done') { %>
										<i class="fa-solid fa-circle-xmark" style="font-size: 32px;color: red;"></i>
									<% } else { %>
										<i class="fa-solid fa-circle-check" style="font-size: 32px;color: #4aff00;"></i>
									<% } %>
								</button>
							</form>
						</div>
					<% } %>
				<% } else { %>
						<div id="daily-view" class="d-flex justify-content-between align-items-center gap-1">
							Today, <%= user.habits[i].dates[6].Date.toDateString('en-IN') %>
							<br>
							<form action="/habits/status/?habitId=<%= user.habits[i]._id %>&dateId=<%= user.habits[i].dates[6]._id %>" method="post">
								<button type="submit" style="border: none; background: transparent;">
									<% if (user.habits[i].dates[6].Status === 'None') { %>
										<i class="fa-solid fa-circle" style="font-size: 32px; color: white;"></i>
									<% } else if(user.habits[i].dates[6].Status === 'Not Done') { %>
										<i class="fa-solid fa-circle-xmark" style="font-size: 32px;color: red;"></i>
									<% } else { %>
										<i class="fa-solid fa-circle-check" style="font-size: 32px;color: #4aff00;"></i>
									<% } %>
								</button>
							</form>
						</div>
					
				<% } %>
					
				<form class="align-self-center" action="/habits/delete/<%= user.habits[i]._id %>" method="post">
						<button class="btn btn-sm btn-danger" type="submit">Delete</button>
				</form>

			</li>
		<% } %>
	</ul>

<% } %>

<script src="/js/dashboard.js"></script>